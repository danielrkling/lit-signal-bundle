var fe=Object.defineProperty,pe=(e,t,r)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,D=(e,t,r)=>(pe(e,typeof t!="symbol"?t+"":t,r),r),me=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},j=(e,t)=>{if(Object(t)!==t)throw TypeError('Cannot use the "in" operator on this value');return e.has(t)},E=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},X=(e,t,r)=>(me(e,t,"access private method"),r);function Z(e,t){return Object.is(e,t)}var f=null,x=!1,b=1,I=Symbol("SIGNAL");function C(e){let t=f;return f=e,t}function ge(){return f}function ve(){return x}var G={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function P(e){if(x)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(f===null)return;f.consumerOnSignalRead(e);let t=f.nextProducerIndex++;if(V(f),t<f.producerNode.length&&f.producerNode[t]!==e&&K(f)){let r=f.producerNode[t];A(r,f.producerIndexOfThis[t])}f.producerNode[t]!==e&&(f.producerNode[t]=e,f.producerIndexOfThis[t]=K(f)?re(e,f,t):0),f.producerLastReadVersion[t]=e.version}function we(){b++}function ee(e){if(!(!e.dirty&&e.lastCleanEpoch===b)){if(!e.producerMustRecompute(e)&&!Ve(e)){e.dirty=!1,e.lastCleanEpoch=b;return}e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=b}}function te(e){if(e.liveConsumerNode===void 0)return;let t=x;x=!0;try{for(let r of e.liveConsumerNode)r.dirty||Te(r)}finally{x=t}}function ye(){return f?.consumerAllowSignalWrites!==!1}function Te(e){var t;e.dirty=!0,te(e),(t=e.consumerMarkedDirty)==null||t.call(e.wrapper??e)}function Se(e){return e&&(e.nextProducerIndex=0),C(e)}function Ce(e,t){if(C(t),!(!e||e.producerNode===void 0||e.producerIndexOfThis===void 0||e.producerLastReadVersion===void 0)){if(K(e))for(let r=e.nextProducerIndex;r<e.producerNode.length;r++)A(e.producerNode[r],e.producerIndexOfThis[r]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Ve(e){V(e);for(let t=0;t<e.producerNode.length;t++){let r=e.producerNode[t],s=e.producerLastReadVersion[t];if(s!==r.version||(ee(r),s!==r.version))return!0}return!1}function re(e,t,r){var s;if(B(e),V(e),e.liveConsumerNode.length===0){(s=e.watched)==null||s.call(e.wrapper);for(let n=0;n<e.producerNode.length;n++)e.producerIndexOfThis[n]=re(e.producerNode[n],e,n)}return e.liveConsumerIndexOfThis.push(r),e.liveConsumerNode.push(t)-1}function A(e,t){var r;if(B(e),V(e),typeof ngDevMode<"u"&&ngDevMode&&t>=e.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${t} is out of bounds of ${e.liveConsumerNode.length} consumers)`);if(e.liveConsumerNode.length===1){(r=e.unwatched)==null||r.call(e.wrapper);for(let n=0;n<e.producerNode.length;n++)A(e.producerNode[n],e.producerIndexOfThis[n])}let s=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[s],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[s],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){let n=e.liveConsumerIndexOfThis[t],h=e.liveConsumerNode[t];V(h),h.producerIndexOfThis[n]=t}}function K(e){var t;return e.consumerIsAlwaysLive||(((t=e?.liveConsumerNode)==null?void 0:t.length)??0)>0}function V(e){e.producerNode??(e.producerNode=[]),e.producerIndexOfThis??(e.producerIndexOfThis=[]),e.producerLastReadVersion??(e.producerLastReadVersion=[])}function B(e){e.liveConsumerNode??(e.liveConsumerNode=[]),e.liveConsumerIndexOfThis??(e.liveConsumerIndexOfThis=[])}function se(e){if(ee(e),P(e),e.value===U)throw e.error;return e.value}function Oe(e){let t=Object.create(xe);t.computation=e;let r=()=>se(t);return r[I]=t,r}var q=Symbol("UNSET"),L=Symbol("COMPUTING"),U=Symbol("ERRORED"),xe={...G,value:q,dirty:!0,error:null,equal:Z,producerMustRecompute(e){return e.value===q||e.value===L},producerRecomputeValue(e){if(e.value===L)throw new Error("Detected cycle in computations.");let t=e.value;e.value=L;let r=Se(e),s,n=!1;try{s=e.computation.call(e.wrapper),n=t!==q&&t!==U&&e.equal.call(e.wrapper,t,s)}catch(h){s=U,e.error=h}finally{Ce(e,r)}if(n){e.value=t;return}e.value=s,e.version++}};function Ne(){throw new Error}var Ee=Ne;function be(){Ee()}function Ie(e){let t=Object.create(Me);t.value=e;let r=()=>(P(t),t.value);return r[I]=t,r}function Pe(){return P(this),this.value}function Ae(e,t){ye()||be(),e.equal.call(e.wrapper,e.value,t)||(e.value=t,Re(e))}var Me={...G,equal:Z,value:void 0};function Re(e){e.version++,we(),te(e)}var m=Symbol("node"),i;(e=>{var t,r,s,n,h,d;class a{constructor(w,g={}){E(this,r),D(this,t);let p=Ie(w)[I];if(this[m]=p,p.wrapper=this,g){let S=g.equals;S&&(p.equal=S),p.watched=g[e.subtle.watched],p.unwatched=g[e.subtle.unwatched]}}get(){if(!(0,e.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return Pe.call(this[m])}set(w){if(!(0,e.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(ve())throw new Error("Writes to signals not permitted during Watcher callback");let g=this[m];Ae(g,w)}}t=m,r=new WeakSet,s=function(){},e.isState=l=>j(r,l),e.State=a;class T{constructor(w,g){E(this,h),D(this,n);let p=Oe(w)[I];if(p.consumerAllowSignalWrites=!0,this[m]=p,p.wrapper=this,g){let S=g.equals;S&&(p.equal=S),p.watched=g[e.subtle.watched],p.unwatched=g[e.subtle.unwatched]}}get(){if(!(0,e.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return se(this[m])}}n=m,h=new WeakSet,d=function(){},e.isComputed=l=>j(h,l),e.Computed=T,(l=>{var w,g,k,p,S;function ie(c){let u,o=null;try{o=C(null),u=c()}finally{C(o)}return u}l.untrack=ie;function ne(c){var u;if(!(0,e.isComputed)(c)&&!(0,e.isWatcher)(c))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((u=c[m].producerNode)==null?void 0:u.map(o=>o.wrapper))??[]}l.introspectSources=ne;function ae(c){var u;if(!(0,e.isComputed)(c)&&!(0,e.isState)(c))throw new TypeError("Called introspectSinks without a Signal argument");return((u=c[m].liveConsumerNode)==null?void 0:u.map(o=>o.wrapper))??[]}l.introspectSinks=ae;function ue(c){if(!(0,e.isComputed)(c)&&!(0,e.isState)(c))throw new TypeError("Called hasSinks without a Signal argument");let u=c[m].liveConsumerNode;return u?u.length>0:!1}l.hasSinks=ue;function le(c){if(!(0,e.isComputed)(c)&&!(0,e.isWatcher)(c))throw new TypeError("Called hasSources without a Computed or Watcher argument");let u=c[m].producerNode;return u?u.length>0:!1}l.hasSources=le;class ce{constructor(u){E(this,g),E(this,p),D(this,w);let o=Object.create(G);o.wrapper=this,o.consumerMarkedDirty=u,o.consumerIsAlwaysLive=!0,o.consumerAllowSignalWrites=!1,o.producerNode=[],this[m]=o}watch(...u){if(!(0,e.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");X(this,p,S).call(this,u);let o=this[m];o.dirty=!1;let v=C(o);for(let N of u)P(N[m]);C(v)}unwatch(...u){if(!(0,e.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");X(this,p,S).call(this,u);let o=this[m];V(o);for(let v=o.producerNode.length-1;v>=0;v--)if(u.includes(o.producerNode[v].wrapper)){A(o.producerNode[v],o.producerIndexOfThis[v]);let N=o.producerNode.length-1;if(o.producerNode[v]=o.producerNode[N],o.producerIndexOfThis[v]=o.producerIndexOfThis[N],o.producerNode.length--,o.producerIndexOfThis.length--,o.nextProducerIndex--,v<o.producerNode.length){let de=o.producerIndexOfThis[v],Q=o.producerNode[v];B(Q),Q.liveConsumerIndexOfThis[de]=v}}}getPending(){if(!(0,e.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[m].producerNode.filter(o=>o.dirty).map(o=>o.wrapper)}}w=m,g=new WeakSet,k=function(){},p=new WeakSet,S=function(c){for(let u of c)if(!(0,e.isComputed)(u)&&!(0,e.isState)(u))throw new TypeError("Called watch/unwatch without a Computed or State argument")},e.isWatcher=c=>j(g,c),l.Watcher=ce;function he(){var c;return(c=ge())==null?void 0:c.wrapper}l.currentComputed=he,l.watched=Symbol("watched"),l.unwatched=Symbol("unwatched")})(e.subtle||(e.subtle={}))})(i||(i={}));var y=(e=null)=>new i.State(e,{equals:()=>!1});var _e=new Set([Symbol.iterator,"concat","entries","every","filter","find","findIndex","flat","flatMap","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","values"]),Fe=new Set(["fill","push","unshift"]);function oe(e){if(typeof e=="symbol")return null;let t=Number(e);return isNaN(t)?null:t%1===0?t:null}var M=class e{static from(t,r,s){return r?new e(Array.from(t,r,s)):new e(Array.from(t))}static of(...t){return new e(t)}constructor(t=[]){let r=t.slice(),s=this,n=new Map,h=!1;return new Proxy(r,{get(d,a){let T=oe(a);if(T!==null)return s.#o(T),s.#e.get(),d[T];if(a==="length")return h?h=!1:s.#e.get(),d[a];if(Fe.has(a)&&(h=!0),_e.has(a)){let l=n.get(a);return l===void 0&&(l=(...w)=>(s.#e.get(),d[a](...w)),n.set(a,l)),l}return d[a]},set(d,a,T){d[a]=T;let l=oe(a);return l!==null?(s.#r(l),s.#e.set(null)):a==="length"&&s.#e.set(null),!0},getPrototypeOf(){return e.prototype}})}#e=y();#t=new Map;#o(t){let r=this.#t.get(t);r===void 0&&(r=y(),this.#t.set(t,r)),r.get()}#r(t){let r=this.#t.get(t);r&&r.set(null)}};Object.setPrototypeOf(M.prototype,Array.prototype);var z=class e{static fromEntries(t){return new e(Object.fromEntries(t))}#e=new Map;#t=y();constructor(t={}){let r=Object.getPrototypeOf(t),s=Object.getOwnPropertyDescriptors(t),n=Object.create(r);for(let d in s)Object.defineProperty(n,d,s[d]);let h=this;return new Proxy(n,{get(d,a,T){return h.#o(a),Reflect.get(d,a,T)},has(d,a){return h.#o(a),a in d},ownKeys(d){return h.#t.get(),Reflect.ownKeys(d)},set(d,a,T,l){let w=Reflect.set(d,a,T,l);return h.#r(a),h.#s(),w},deleteProperty(d,a){return a in d&&(delete d[a],h.#r(a),h.#s()),!0},getPrototypeOf(){return e.prototype}})}#o(t){let r=this.#e.get(t);r===void 0&&(r=y(),this.#e.set(t,r)),r.get()}#r(t){let r=this.#e.get(t);r&&r.set(null)}#s(){this.#t.set(null)}},We=z;var R=class{collection=y();storages=new Map;vals;readStorageFor(t){let{storages:r}=this,s=r.get(t);s===void 0&&(s=y(),r.set(t,s)),s.get()}dirtyStorageFor(t){let r=this.storages.get(t);r&&r.set(null)}constructor(t){this.vals=t?new Map(t):new Map}get(t){return this.readStorageFor(t),this.vals.get(t)}has(t){return this.readStorageFor(t),this.vals.has(t)}entries(){return this.collection.get(),this.vals.entries()}keys(){return this.collection.get(),this.vals.keys()}values(){return this.collection.get(),this.vals.values()}forEach(t){this.collection.get(),this.vals.forEach(t)}get size(){return this.collection.get(),this.vals.size}[Symbol.iterator](){return this.collection.get(),this.vals[Symbol.iterator]()}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}set(t,r){return this.dirtyStorageFor(t),this.collection.set(null),this.vals.set(t,r),this}delete(t){return this.dirtyStorageFor(t),this.collection.set(null),this.vals.delete(t)}clear(){this.storages.forEach(t=>t.set(null)),this.collection.set(null),this.vals.clear()}};Object.setPrototypeOf(R.prototype,Map.prototype);var _=class{collection=y();storages=new Map;vals;storageFor(t){let r=this.storages,s=r.get(t);return s===void 0&&(s=y(),r.set(t,s)),s}dirtyStorageFor(t){let r=this.storages.get(t);r&&r.set(null)}constructor(t){this.vals=new Set(t)}has(t){return this.storageFor(t).get(),this.vals.has(t)}entries(){return this.collection.get(),this.vals.entries()}keys(){return this.collection.get(),this.vals.keys()}values(){return this.collection.get(),this.vals.values()}forEach(t){this.collection.get(),this.vals.forEach(t)}get size(){return this.collection.get(),this.vals.size}[Symbol.iterator](){return this.collection.get(),this.vals[Symbol.iterator]()}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}add(t){return this.dirtyStorageFor(t),this.collection.set(null),this.vals.add(t),this}delete(t){return this.dirtyStorageFor(t),this.collection.set(null),this.vals.delete(t)}clear(){this.storages.forEach(t=>t.set(null)),this.collection.set(null),this.vals.clear()}};Object.setPrototypeOf(_.prototype,Set.prototype);var H=!1,F=new i.subtle.Watcher(()=>{H||(H=!0,queueMicrotask(()=>{H=!1,ke()}))});function ke(){for(let e of F.getPending())e.get();F.watch()}function De(e){let t=new i.Computed(()=>e());return F.watch(t),t.get(),()=>{F.unwatch(t)}}function je(e,t){return new O(e,t)}var O=class{#e;#t;constructor(t,r){this.#e=t,this.#o=new i.State(r?.initialValue),this.staleTime=r?.staleTime,this.#t=new i.Computed(()=>(this.refresh(),this))}async refresh(){this.#s.set("fetching");try{let t=await this.#e();this.setValue(t)}catch(t){this.#s.set("rejected"),this.#r.set(t)}}#o;get value(){return this.#s.get()==="stale"&&this.refresh(),this.#t.get(),this.#o.get()}setValue(t){this.#s.set("resolved"),this.#o.set(t),this.#r.set(null),this.#n()}#r=new i.State(null);get error(){return this.#s.get()==="rejected"?this.#r.get():null}#s=new i.State("initial");get status(){return this.#t.get(),this.#s.get()}get isPending(){let t=this.status;return t==="fetching"||t==="initial"}get isResolved(){return this.status==="resolved"}get isRejected(){return this.status==="rejected"}#i;#n(){clearTimeout(this.#i),this.staleTime!==void 0&&(this.#i=setTimeout(()=>this.#s.set("stale"),this.staleTime))}};var Y=new Map;function qe(e,t,r){if(Y.has(e))return Y.get(e);{let s=new O(t,r);return Y.set(e,s),s}}var W=class{#e;#t=new i.State(null);#o=new i.State(!1);#r=new i.State(!1);constructor(t={}){this.#e=t.validate,this.initialValue=t.initialValue,this.fields={};for(let r in t.fields)this.fields[r]=new J(this,r,{...t.fields[r],initialValue:t.initialValue?.[r]})}get fieldArray(){return Object.values(this.fields)}async#s(){try{let t=await this.#e?.(this.value);return this.#t.set(t),!!t}catch(t){return this.#t.set(t),!!t}}async validate(){this.#r.set(!1),this.#o.set(!0);let t=await Promise.all([this.#s(),...this.fieldArray.map(r=>r.validate())]);return this.#r.set(!0),this.#o.set(!1),t.every(Boolean)}get error(){return this.#t.get()}get isValidated(){return this.#r.get()}get isValidating(){return this.#o.get()}get errors(){return[this.error].concat(...this.fieldArray.map(t=>t.errors)).filter(Boolean)}#i=new i.Computed(()=>this.value===this.initialValue);get isPristine(){return this.#i.get()}get isDirty(){return!this.isPristine}#n=new i.Computed(()=>this.isValidated&&!!this.error||this.fieldArray.some(t=>t.isInvalid));get isInvalid(){return this.#n.get()}get isValid(){return this.isValidated&&!this.isInvalid}get value(){throw new Error("Getter 'value' must be implemented in derived class.")}setValue(t){this.#r.set(!1)}},$=class extends W{#e;constructor(t){super(t),this.#e=new i.State(t.initialValue??{})}get value(){return this.#e.get()}setValue(t){super.setValue(t),this.#e.set(t)}#t=new i.State(0);#o=new i.Computed(()=>this.#t.get()>0);#r=new i.State(!1);#s=new i.State(null);async handleSubmit(t,r){try{await this.validate(),this.#r.set(!0),this.#s.set(null),this.isValid?this.#s.set(await t?.(this.value,this)):(this.focusError(),this.#s.set(await r?.(this.value,this)))}catch(s){this.#s.set(s)}finally{this.#r.set(!1),this.#t.set(this.#t.get()+1)}}get submitCount(){return this.#t.get()}get isSubmitted(){return this.#o.get()}get isSubmitting(){return this.#r.get()}focusError(){for(let t of this.fieldArray)if(t.focusError())return!0;return!1}},J=class extends W{constructor(t,r,s){super(s),this.control=t,this.name=r,this.ref={}}#e=new i.Computed(()=>this.control.value?.[this.name]);get value(){return this.#e.get()}setValue(t){super.setValue(t);let r=this.control.value;this.control.setValue({...r,[this.name]:t})}focusError(){if(this.ref.value&&this.isInvalid)return this.ref.value.focus(),!0;for(let t of this.fieldArray)if(t.focusError())return!0;return!1}};function Le(e,t){let r=new i.State(e(),t),s=new i.Computed(()=>{r.set(e())}),n=!1,h=new i.subtle.Watcher(()=>{n||(n=!0,queueMicrotask(()=>{s.get(),n=!1})),h.watch()});return h.watch(s),s.get(),r}function dt(e,t){return new i.State(e,t)}function ft(e,t){return new i.Computed(e,t)}export{O as AsyncMemo,$ as Form,i as Signal,M as SignalArray,R as SignalMap,We as SignalObject,_ as SignalSet,je as asyncMemo,De as effect,ft as memo,qe as query,dt as signal,Le as writableMemo};
/*! Bundled license information:

signal-polyfill/dist/index.js:
  (**
   * @license
   * Copyright Google LLC All Rights Reserved.
   *
   * Use of this source code is governed by an MIT-style license that can be
   * found in the LICENSE file at https://angular.io/license
   *)
  (**
   * @license
   * Copyright 2024 Bloomberg Finance L.P.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
